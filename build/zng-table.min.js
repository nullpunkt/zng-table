"use strict";if(angular.module("zng.table.templates",[]).run(["$templateCache",function(a){a.put("template/zng-table/pagination.html",'<div class="table-pager count" ng-show=pagination.display><span class=ng-binding ng-bind=pagination.firstItemNumber()></span> <span>-</span> <span class=ng-binding ng-bind=pagination.lastItemNumber()></span> <span>von</span> <span class=ng-binding ng-bind=pagination.max></span><div class=pager-actions><input type=button class="btn small" value=&lt; onclick=this.blur() ng-class="{inactive: pagination.page == 1}" ng-click=pagination.changePage(-1)> <input type=button class="btn small" value=&gt; onclick=this.blur() ng-class="{inactive: pagination.page == pagination.lastPage()}" ng-click=pagination.changePage(1)> <span class=dropdown><input type=button class="btn small settings dropdown-toggle" value=+ onclick=this.blur()><ul class=dropdown-menu role=menu><li class=divider>Eintr√§ge pro Seite</li><li ng-repeat="perPage in pagination.perPageOptions" ng-bind=perPage ng-click=pagination.changePerPage(perPage);></li></ul></span></div><div class=clear></div></div>'),a.put("template/zng-table/table.html",'<div><table ng-class=config.styles.table ng-style=styles.table()><colgroup><col ng-repeat="field in table.headline.fields" ng-class="field.clazz"></colgroup><thead ng-show=config.displayHeadline><tr><th ng-repeat="field in table.headline.fields" ng-bind=field.value ng-class=field.clazz ng-click=sort($index)></th></tr></thead><tbody><tr ng-repeat="row in table.data" ng-class=row.clazz ng-click=click.row(row)><td ng-repeat="field in row.fields" ng-class=field.clazz ng-bind=field.value></td></tr></tbody></table></div>')}]),"undefined"==typeof zng)var zng={};zng.table={ORDER_DIRECTION_ASC:"tableOrderAsc",ORDER_DIRECTION_DESC:"tableOrderDesc",EVENT_CLICKED_ROW:"tableEventClickedRow"};var table=angular.module("zng.table",["zng.table.templates"]);table.directive("zngTable",function(){return{restrict:"E",replace:!0,templateUrl:function(a,b){return b.template||"template/zng-table/table.html"},scope:{table:"=table"},link:function(a,b){a.$watch(function(){a.__width=b.prop("offsetWidth")},!0)},controller:["$scope",function(a){a.$watch("table",function(b){a.config=a.table.config}),a.$watch("table.handler.oos",function(b){a.table.handler.update()}),a.$watch("table.pagination",function(b){"undefined"!=typeof b&&a.table.handler.update()},!0),a.$watch("__width",function(a){}),a.sort=function(b){a.table.handler.fields[b].sortable&&(a.config.sort={direction:b===a.config.sort.index&&a.config.sort.direction===zng.table.ORDER_DIRECTION_ASC?zng.table.ORDER_DIRECTION_DESC:zng.table.ORDER_DIRECTION_ASC,index:b},a.table.handler.update())},a.styles={table:function(){var b={};return a.config.autoWidth&&(b.width=a.__width+"px"),b}},a.click={row:function(b){a.table.fire(zng.table.EVENT_CLICKED_ROW,b.raw)}}}]}}),table.service("zngTable",["$filter",function(a){return{create:function(b,c,d){d=angular.extend({displayHeadline:!0,autoWidth:!0,styles:{table:null},sort:{index:0,direction:zng.table.ORDER_DIRECTION_ASC},pagination:{},handler:{click:null}},d);var e={config:d,headline:[],data:[],handler:null,eventHandler:{},$filter:a,pagination:angular.extend({max:0,perPage:25,page:1,display:!0,perPageOptions:[10,25,50,100],startIndex:function(){return(this.page-1)*this.perPage},endIndex:function(){var a=this.startIndex()+(this.perPage-1),b=this.max-1;return a>b&&(a=b),a},firstItemNumber:function(){return this.startIndex()+1},lastItemNumber:function(){return this.endIndex()+1},offset:function(){return this.startIndex()},changePage:function(a){this.page+=a,this.page<1&&(this.page=1),this.page>this.lastPage()&&(this.page=this.lastPage())},lastPage:function(){return Math.ceil(this.max/this.perPage)},changePerPage:function(a){this.page=1,this.perPage=a}},d.pagination),addField:function(a,b,c){return e.handler.addField(a,b,c),this},setIdField:function(a){return e.handler.setIdField(a),this},addEventListener:function(a,b){return e.eventHandler[a]||(e.eventHandler[a]=[]),e.eventHandler[a].push(b),this},fire:function(a,b){angular.forEach(e.eventHandler[a],function(a){a(b)})}};return e.handler=new b(e),e.handler.initialize(c),e}}}]),zng.table.handler={AbstractHandler:function(a){if("undefined"==typeof a)throw"Please insert zngTable as first argument in handler function.";this.oos=!0,this.initialize=function(a){},this.getHeadline=function(){},this.getData=function(){},this.setIdField=function(a){},this.setOutOfSync=function(){this.oos=!0},this.synchronize=function(){this.oos&&this.update()},this.update=function(){a.headline=this.getHeadline(),a.data=this.getData(),this.oos=!1}},BasicHandler:function(a){angular.extend(this,new zng.table.handler.AbstractHandler(a)),this.base=null,this.fields=[];var b={};this.initialize=function(a){angular.isArray(a)?this.setBase(a):angular.isObject(a)&&(this.setBase(a.data),angular.isObject(a.config)&&angular.forEach(a.config,function(a,c){angular.isDefined(b[c])&&(b[c]=a)}))},this.setBase=function(b){this.base=b,a.pagination.max=this.base.length,this.setOutOfSync()},this.addField=function(a,b,c){return(c===!0||c===!1)&&(c={sortable:c}),c=angular.extend({sortable:!1,sortIndex:null,clazz:[],filter:null},c),this.fields.push({topic:a,index:b,sortable:c.sortable,sortIndex:c.sortIndex,clazz:c.clazz,filter:c.filter}),this},this.resetFields=function(){this.fields.length=0},this.getHeadline=function(){var b=a.config.sort,c={fields:[]};return angular.forEach(this.fields,function(a,d){var e=[];a.sortable&&(e.push("sortable"),b.index===d&&b.direction===zng.table.ORDER_DIRECTION_ASC&&e.push("sort-asc"),b.index===d&&b.direction===zng.table.ORDER_DIRECTION_DESC&&e.push("sort-desc")),angular.forEach(a.clazz,function(a){e.push(a)}),c.fields.push({value:a.topic,clazz:e})}),c},this.getData=function(){if(0===this.fields.length)return[];var b=[],c=this,d=a.pagination,e=a.config.sort;return angular.forEach(this.base,function(d){var e={raw:d,fields:[]};angular.forEach(c.fields,function(b){var c=null===b.sortIndex?b.index:b.sortIndex,f=d[b.index];if(null!==b.filter){var g=angular.copy(b.filter),h=g.shift();g.unshift(f),f=a.$filter(h).apply(this,g)}e.fields.push({value:f,order:d[c],clazz:[]})}),b.push(e)}),b=b.sort(function(a,b){var c=a.fields&&a.fields[e.index]&&a.fields[e.index].order?a.fields[e.index].order:null,d=b.fields&&b.fields[e.index]&&b.fields[e.index].order?b.fields[e.index].order:null,f=e.direction===zng.table.ORDER_DIRECTION_DESC;return d>c?f?1:-1:f?-1:1}),b.slice(d.startIndex(),d.endIndex()+1)}}},table.directive("zngPagination",function(){return{restrict:"E",replace:!0,templateUrl:function(a,b){return b.template||"template/zng-table/pagination.html"},scope:{pagination:"=config"},link:function(a,b){},controller:function(a){}}});